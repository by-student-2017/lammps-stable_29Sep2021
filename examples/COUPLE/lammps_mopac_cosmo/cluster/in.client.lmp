#-----------------------------------------------------------------------------------------
# The one molecule in water for use with DFTB+
# test: lammps-stable_29Sep2021
#-------------------- Initialization -----------------------------------------------------
clear
echo            both    # echoes each input script command to both log file and screen
#package         omp 1   # of OpenMP threads: export OMP_NUM_THREADS=16 (need: yes-OPENMP)
#-----------------------------------------------------------------------------------------
variable        mode index file
 
if "${mode} == file" then &
  "message client md file tmp.couple" &
elif "${mode} == zmq" &
  "message client md zmq localhost:8888" &

# Note: General Web (localhost:80), Secure HTTPS (localhost:443), Develop. XAMPP (localhost:8888), Develop. Web (localhost:5555)
#-----------------------------------------------------------------------------------------
units           metal
dimension       3
boundary        m m m
atom_style      charge
atom_modify     sort 0 0.0 map yes

#-----------------------------------------------------------------------------------------
variable Tini equal 273+28.0 # [K] (Initial temperature)
variable Tfin equal 273+28.0 # [K] (Annealing temperature)

variable Nout equal  100 # every 100 time steps to the specified file

variable tdump equal  20 # dumping factor

variable elem string "C O H"

#-------------------- Atom & Lattice description ----------------------------------------
read_data data.lammps

#-------------------- pair style settings --------------------------------
pair_style zero 1.0
pair_coeff * *

#-------------------- Settings -----------------------------------------------------------

#mass 3 2.00 # H => D (Make the hydrogen heavier to increase the timestep)

neighbor        2.0 bin # 0.3 is lj unit. 2.0 [Angstrom] is metal or real units
neigh_modify delay 0 every 10 check no
comm_modify cutoff 2.0 # = comm_modify mode single group all cutoff 2.0 vel yes

thermo          ${Nout} # computes and prints thermodynamic 
thermo_style custom step temp pe etotal ecoul press vol density # specifies content of thermodynamic data to be printed in screen

velocity        all create ${Tini} 123456 loop geom # sets the velocity of a group of atoms

#fix             f1 all nve
fix             f2 all client/md
fix_modify      f2 energy yes # or 2 virial yes
#fix             f3 all temp/berendsen ${Tini} ${Tfin} $(v_tdump*dt)
#fix             f3 all langevin ${Tini} ${Tfin} $(v_tdump*dt) 12345

#-------------------- Energy minimization ------------------------------------------------
minimize 0.0 1.0e-8 10000 10000

#-------------------- Run the simulation -------------------------------------------------
reset_timestep 0

# Set the number of SCFs for symmetrical cases to be calculated by MOPAC at least on average.
# Or set it to the maximum expected number of SCFs if you want to run it safely even if it takes a long time.
variable nSCF equal 100

# Since the calculation is performed with one SCF, the time step must be reduced by the number of original SCFs.
timestep        $(0.001*1.0/v_nSCF) # 1.0/nSCF [fs]

# Equilibrium system, calculation settings
fix integrate all nvt temp ${Tini} ${Tfin} $(v_tdump*dt)
#fix integrate all npt temp ${Tini} ${Tfin} $(v_tdump*dt) iso 1.0 1.0 $(v_tdump*10*dt)

#-------------------- 
dump            d1 all cfg ${Nout} cfg/run.*.cfg mass type xs ys zs id type q
dump_modify     d1 element ${elem}
#-------------------- 
#dump            d2 main cfg ${Nout} cfg/run_main.*.cfg mass type xs ys zs id type q
#dump_modify     d2 element ${elem}
#-------------------- 

run             $(v_nSCF*10)

#-------------------- End ----------------------------------------------------------------
